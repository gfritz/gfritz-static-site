<html>
  <head>
    <meta charSet="utf-8"/>
    <title>
      Clearing Entity Fields in Early Bound Plugin Code
    </title>
    <link rel="stylesheet" type="text/css" href="/css/style.css"/>
    <link rel="alternate" type="application/atom+xml" href="/feed.xml" title="News Feed"/>
  </head>
  <body>
    <div class="container">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/">
            Garth Blog
          </a>
          <small class="masthead-link">
            <a href="/archive.html">
              Archive
            </a>
          </small>
        </h3>
      </header>
      <div id="content">
        <article class="post">
          <h1 class="post-title">
            Clearing Entity Fields in Early Bound Plugin Code
          </h1>
          <div class="post-date">
            2/22/2017
          </div>
          <p>If you try to NULL the value of an Entity field and save that change with the CRM OrganizationServiceContext, you need to be careful how you set that NULL value.  If the field to NULL is not in the <code>myEntity.Attributes</code> collection, then it will not be updated when the service call updates the record in CRM.</p>
<p>We can demonstrate this by initializing the early bound Account entity in a few different ways and inspecting the Attribute collection.  The field to clear in this example will be <code>ParentAccountId</code>.</p>
<p>First, we will use the constructor then NULL with dot notation.<br />
Second, we use the object initializer syntax and null with that.
Third, we initialize only the ID field and use dot notation to set the field NULL.</p>
<p>These attempts will not put ParentAcountId into the Attributes collection.  Two ways that will work are setting the field to NULL with the late bound class, and initializing or setting ParentAccountId with a dummy non-NULL value in the early bound class then setting the field to NULL.</p>
<p>This test class will demonstrate each of these approaches.</p>
<script src="https://gist.github.com/gfritz/bf68281d1326bcc2afe0.js"></script>
<p>In this case, using the late bound entity is more straightforward than using the early bound entity.  With late bound you will not get intellisense so make sure you have the correct spelling and casing for your field.  You can find the correct string to use in your early bound entities file by hitting F12 on the early bound field and inspecting the method decorator.  For our field, we use the string in here: <code>[Microsoft.Xrm.Sdk.AttributeLogicalNameAttribute(&quot;parentaccountid&quot;)]</code>.</p>
<p>If you use the <a href="https://github.com/daryllabar/DLaB.Xrm.XrmToolBoxTools/releases">Early Bound Generator tool</a> from the <a href="http://www.xrmtoolbox.com/">XRM Toolbox</a>, one particularly useful thing it does is enumerates each attribute name as a struct of strings.  That provides intellisense and the correctly cased string name of the field.</p>
<p>Initializing an early bound entity field with NULL looks like code that should work, but chances are you only notice the problem when the update does not clear that field in CRM.  You could just as easily do <code>earlyBoundAccount[&quot;parentaccountid&quot;] = null;</code>, but why would that be your first choice when you have early bound classes?</p>
<p>You might consider a wrapper class to handle this NULL setting logic for you, or probably simpler still an extension method <code>SetToNull(myAccount, &quot;nameOfFieldToClear&quot;)</code> so you can use this for all entities.  Remember to use the <code>Fields</code> struct if you use the Early Bound Generator to create your early bound classes - <code>SetToNull(myAccount, Account.Fields.NameOfFieldToClear)</code>.</p>

        </article>
      </div>
    </div>
  </body>
</html>